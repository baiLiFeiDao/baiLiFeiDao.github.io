---
title: 若依框架中@DataScope数据权限过滤
date: 2023-09-15 17:02:10
tags:
- 若依框架
---

## 背景

若依框架本身具有角色、部门、用户业务。

在项目中，用户必须绑定一个角色，角色又必须将自身绑定到部门，角色绑定了哪些部门，就决定隶属该角色的用户能对哪些部门数据进行增删改。

一般情况下，假如我们对一张表要进行查询或更新的话，需要在sql语句中，where条件语法后面 加上 dept.id = {currentDeptId} 来进行过滤，

```sql
select * from sys_user
where dept_id = {currentUserDeptId}
```

在若依框架中，我们只需要在Service层的方法上加入`@DataScope`注解，并分别通过deptAlias和userAlias属性，指定出部门表和用户表在sql语句中的别名是什么的话，就不需要我们手动在sql语句后面加上过滤条件了。

## 使用数据权限过滤

1.创建一个实体类，继承BaseEntity

![在这里插入图片描述](https://img-blog.csdnimg.cn/34bbaf2df60344aea709c093aa3b744b.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBA5ZCb44KS6KaL44Gk44GR44Gm,size_20,color_FFFFFF,t_70,g_se,x_16)

BaseEntity实体类中，有一个类型为map,名称为params的属性

![在这里插入图片描述](https://img-blog.csdnimg.cn/dc86000db3184a83838085b345bfb2bb.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBA5ZCb44KS6KaL44Gk44GR44Gm,size_19,color_FFFFFF,t_70,g_se,x_16)

2.在对应的mapper.xml文件中，对应sql语句的末尾，我们引用SysDept所继承的BaseEntity父类中的’params’属性。
${params.dataScope}

![在这里插入图片描述](https://img-blog.csdnimg.cn/f190aaf89d7a4949913e19090f274bcb.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBA5ZCb44KS6KaL44Gk44GR44Gm,size_20,color_FFFFFF,t_70,g_se,x_16)

3.在调用Mapper层的方法，加入@DataScope注解，指定sql语句中用户表和部门表的别名

![在这里插入图片描述](https://img-blog.csdnimg.cn/82e01ebc81cf45f083bbd3cc1c41001b.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBA5ZCb44KS6KaL44Gk44GR44Gm,size_20,color_FFFFFF,t_70,g_se,x_16)

4.接下来我们前端访问controller，debug然后进入到service层的这个方法，我们会惊奇的发现。SysDept所继承的BaseEntity父类的params属性，有了值。而这个值，就是数据过滤相关的sql语句。

![在这里插入图片描述](https://img-blog.csdnimg.cn/3eadd1aa0d0f4ca4ba8693db9ec2b199.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBA5ZCb44KS6KaL44Gk44GR44Gm,size_20,color_FFFFFF,t_70,g_se,x_16)
